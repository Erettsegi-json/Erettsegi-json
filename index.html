<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="description" content="">
<meta name="author" content="Boa">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Érettségi kereső</title>
<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>

<h1>Érettségi kereső</h1>
<p id="description">mert az oktatas.hu nem embereknek készült</p>

<div id="selects">
<select id="time"></select>
<select id="level"></select>
<select id="subject"></select>
</div>

<div id="results"></div>

<footer>
<p>Készítette: Boa, </p>
<a href="https://github.com/Erettsegi-json/Erettsegi-json"> forráskód</a>
</footer>

</body>
<script>
let times = new Set();
let levels = new Set();
let subjects = new Set();    
let timeSelect = document.getElementById("time");
let levelSelect = document.getElementById("level");
let subjectSelect = document.getElementById("subject");
let resdiv = document.getElementById("results");

let requestURL = 'https://raw.githubusercontent.com/Erettsegi-json/Erettsegi-json/master/erettsegi.json';
let request = new XMLHttpRequest();
request.open('GET', requestURL);
request.responseType = 'text';
request.send();
request.onload = function() {
    const erettsegiResponse = request.response;
    const erettsegiJSON = JSON.parse(erettsegiResponse);
    setSelects(erettsegiJSON);
}

function refresh(erettsegiJSON) {
    let results = Array();
    resdiv.innerHTML = '';
    let resultsNumber = 0;
    for (i = 0; i < erettsegiJSON.length; i++){
        if (("Bármikor" === times[timeSelect.selectedIndex] || erettsegiJSON[i].time === times[timeSelect.selectedIndex]) && ("Bármelyik szint" === levels[levelSelect.selectedIndex] || erettsegiJSON[i].level === levels[levelSelect.selectedIndex]) && ("Bármelyik tárgy" === subjects[subjectSelect.selectedIndex] || erettsegiJSON[i].subject === subjects[subjectSelect.selectedIndex])) {
            resultsNumber++;
            var card = document.createElement("div");
            card.className = "card";
            var titleParagraph = document.createElement("p");
            titleParagraph.className = "title";
            titleParagraph.innerHTML = erettsegiJSON[i].level + " " + erettsegiJSON[i].subject;
            card.appendChild(titleParagraph);
            for (let link of erettsegiJSON[i].links){
                var linkElement = document.createElement("a");
                var linkParagraph = document.createElement("p");
                linkParagraph.className = "link";
                linkParagraph.appendChild(linkElement);
                card.appendChild(linkParagraph);
                linkElement.href = "http://oktatas.hu" + link;
                linkElement.innerHTML = link.substring(link.lastIndexOf("/")+1);
            }
            var timeParagraph = document.createElement("p");
            timeParagraph.className = "time";
            timeParagraph.innerHTML = erettsegiJSON[i].time;
            card.appendChild(timeParagraph);
            resdiv.appendChild(card);
        }
    }
    if (resultsNumber === 0) {
        resdiv.innerHTML = '<p>Nincs találat</p>';
    }
}

function setSelects(erettsegiJSON) {
    for (i = 0; i < erettsegiJSON.length; i++){
        times.add(erettsegiJSON[i].time);
        levels.add(erettsegiJSON[i].level);
        subjects.add(erettsegiJSON[i].subject);
    }
    
    times = Array.from(times).sort();
    levels = Array.from(levels);
    subjects = Array.from(subjects).sort();
    
    timeSelect.addEventListener('change', function() {
        refresh(erettsegiJSON);
    });
    
    subjectSelect.addEventListener('change', function() {
        refresh(erettsegiJSON);
    });
    
    levelSelect.addEventListener('change', function() {
        refresh(erettsegiJSON);
    });
    
    times.unshift("Bármikor");
    for (let time of times) {
        timeSelect.options.add(new Option(time, time));
    }

    levels.unshift("Bármelyik szint");
    for (let level of levels) {
        levelSelect.options.add(new Option(level, level));
    }

    subjects.unshift("Bármelyik tárgy");
    for (let subject of subjects) {
        subjectSelect.options.add(new Option(subject, subject));
    }
}
</script>
</html>
